<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
	<Product Id="*" Name="ExoKey Host Application" Language="1033" Version="1.0.0.3" Manufacturer="x.o.ware, Inc." UpgradeCode="6b60c82d-4722-441f-a573-70765a1af96a">
		<Package InstallerVersion="200" Compressed="yes" InstallScope="perMachine" />


    <!-- HowTo http://wixtoolset.org/documentation/manual/v3/howtos/updates/major_upgrade.html -->
    <MajorUpgrade AllowDowngrades="no" 
                  Schedule="afterInstallInitialize" AllowSameVersionUpgrades="yes"
                  DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
		<MediaTemplate />
    <Property Id="PREVIOUSVERSIONSINSTALLED" Secure="yes" />
    <!--
    <InstallExecuteSequence>
      <RemoveExistingProducts After="InstallInitialize"/>
    </InstallExecuteSequence>

    <Upgrade Id="6b60c82d-4722-441f-a573-70765a1af96a">
      <UpgradeVersion
         Minimum="1.0.0.0" Maximum="99.0.0.0"
         Property="PREVIOUSVERSIONSINSTALLED"
         IncludeMinimum="yes" IncludeMaximum="no" />
    </Upgrade>
-->


    <Feature Id="ProductFeature" Title="ExoKey Host Application Setup" Level="1">
			<ComponentGroupRef Id="ProductComponents" />
      <ComponentGroupRef Id="localesComponent" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="ProgramMenuDir"/>
		</Feature>

    <Property Id="VC2012REDIST">
      <RegistrySearch Id="VC2012"
                      Root="HKLM"
                      Key="HKLM\SOFTWARE\Microsoft\DevDiv\VC\Servicing\11.0"
               Name="Install"
                      Type="raw" />
    </Property>
	</Product>


	<Fragment>
		<Directory Id="TARGETDIR" Name="SourceDir">
			<Directory Id="ProgramFilesFolder">
				<Directory Id="INSTALLFOLDER" Name="XoWare">
          <Directory Id="localesFolder" Name="locales" />
        </Directory>
			</Directory>
      
      <Directory Id="DesktopFolder" Name="Desktop" />

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ApplicationProgramsFolder" Name="ExoKey">
          <Component Id="ProgramMenuDir" Guid="{3D998B2D-77FC-4483-8223-30F89E7D7A51}">
            <RemoveFolder Id="ProgramMenuDir" On="uninstall"/>
            <RegistryValue Root="HKCU" Key="Software\[Manufacturer]\ExoKey"
                           Type="integer" Value="1" Name="installed" KeyPath="yes" />
          </Component>
        </Directory>
      </Directory>
 
    </Directory>
	</Fragment>
  <Fragment>
   
  </Fragment>

	<Fragment>
		<ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
			<!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
      <Component Id="ExoKeyHostApp.exe" Guid="{B6AD8A3B-ADAE-4C93-8DF2-12B489E22D8A}">
        <File Source="$(var.ExoKeyHostApp.TargetPath)"  />
        <Shortcut Id="desktopShortcut" Advertise="yes" Directory="DesktopFolder"
                    Name="ExoKey" WorkingDirectory="INSTALLFOLDER"
                    Icon="icon1.exe" IconIndex="0">
          <Icon Id="icon1.exe" SourceFile="$(var.ExoKeyHostApp.TargetPath)" />
        </Shortcut>
        <Shortcut Id="startMenuShotcut" Directory="ApplicationProgramsFolder"
                  Name="Exokey" WorkingDirectory="INSTALLFOLDER"
                  Icon="icon2.exe" IconIndex="0" Advertise="yes">
            <Icon Id="icon2.exe" SourceFile="$(var.ExoKeyHostApp.TargetPath)" />
        </Shortcut>
      </Component>
		  <Component Id="ProductComponent" Guid="{D326B7F1-2339-404F-A47E-4239C2291901}">
				<!-- TODO: Insert files, registry keys, and other resources here. -->
       
        <File Source="$(var.ExoKeyHostApp.ProjectDir)/avcodec-54.dll" />
        <File Source="$(var.ExoKeyHostApp.ProjectDir)/avformat-54.dll" />
        <File Source="$(var.ExoKeyHostApp.ProjectDir)/avutil-51.dll" />
        <File Source="$(var.ExoKeyHostApp.ProjectDir)/CefSharp.dll" /> 
        <File Source="$(var.ExoKeyHostApp.TargetDir)/CefSharp.WinForms.dll" />
        
		 </Component>
      
      <Component Id="icudt" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\icudt.dll" />
      </Component>
      <Component Id="libcef" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\libcef.dll" />
      </Component>
      <Component Id="libEGL" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\libEGL.dll" />
      </Component>
      <Component Id="libGLESv2" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\libGLESv2.dll" />
      </Component>
      <Component Id="msvcp110dll" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\msvcp110.dll" />
      </Component>
      <Component Id="msvcr110dll" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\msvcr110.dll" />
      </Component>
      <Component Id="vccorlib110dll" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\vccorlib110.dll" />
      </Component>
      <Component Id="RoutingDll" Guid="*">      
         <File Source="$(var.ExoKeyHostApp.TargetDir)/Routing.dll" />
      </Component>
      <Component Id="vpexIco" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\vpex.ico" />
      </Component>
            <Component Id="XoKeyApi.dll" Guid="*">      
         <File Source="$(var.ExoKeyHostApp.TargetDir)/XoKeyApi.dll" />
      </Component>
      <Component Id="waitHtml" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\waiting_for_hw.html" />
      </Component>
      <Component Id="LoadingGif" Guid="*">
          <File Source="$(var.ExoKeyHostApp.ProjectDir)\loading.gif" />
      </Component>
      <Component Id="config" Guid="*">
          <File Source="$(var.ExoKeyHostApp.TargetDir)\ExoKeyHostApp.exe.config" />
      </Component>

		</ComponentGroup>
   </Fragment>
  
  <Fragment>
    <ComponentGroup Id="localesComponent" Directory="localesFolder">
      <Component Id="enUsPakComponent" Guid="*">
        <File Source="$(var.ExoKeyHostApp.TargetDir)\locales\en-US.pak" /> 
      </Component>
    </ComponentGroup>
  </Fragment>
  <Fragment>
  <DirectoryRef Id="ApplicationProgramsFolder">
    <Component Id="ApplicationShortcut" Guid="{053CE9D9-E983-4B76-A963-3BB1B6FD70A1}">
      <Shortcut Id="ApplicationStartMenuShortcut"
                Name="ExoKey Host Application"
                Description="x.o.ware ExoKey Host Application"
                Target="ExoKeyHostApp.exe"
                WorkingDirectory="APPLICATIONROOTDIRECTORY"/>
      <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
      <RegistryValue Root="HKCU" Key="Software\Xoware\EExoKeyHostApp" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
    </Component>
  </DirectoryRef>
  </Fragment>
</Wix>